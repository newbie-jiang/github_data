<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GitHub å¤šç”¨æˆ·ä»“åº“å±•ç¤º</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* æ¸å˜æ–‡å­— */
    .text-gradient {
      background: linear-gradient(90deg, #3b82f6, #06b6d4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    /* é€‰é¡¹æ¡†å­—ä½“é¢œè‰²è°ƒæ•´ä¸ºé»‘è‰² */
    #user-select {
      color: #000;
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen text-gray-900 dark:text-gray-100">
  <div class="container mx-auto p-4">
    <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
      <h1 class="text-3xl font-bold">GitHub å¤šç”¨æˆ·ä»“åº“å±•ç¤º</h1>
      <!-- æœ€åæ›´æ–°æ—¶é—´æ˜¾ç¤º -->
      <div id="last-update" class="text-gray-600 dark:text-gray-300 text-sm whitespace-nowrap"></div>
      <button id="theme-toggle" class="ml-2 px-2 py-1 border rounded text-sm bg-gray-200 dark:bg-gray-700">ğŸŒ™</button>
    </div>

    <div class="mb-4 flex flex-wrap gap-4 items-center">
      <label class="font-semibold whitespace-nowrap">é€‰æ‹©ç”¨æˆ·ï¼š</label>
      <select id="user-select" class="p-2 border rounded flex-grow min-w-[120px] max-w-xs"></select>
      <button
        id="show-all"
        class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 whitespace-nowrap"
      >
        å…¨éƒ¨ä»“åº“
      </button>
      <!-- å½“å‰ç”¨æˆ·ä»“åº“æ•°æ˜¾ç¤º -->
      <div id="repo-count" class="ml-auto font-semibold text-gray-700 whitespace-nowrap"></div>
    </div>

    <div
      id="repo-list"
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"
    ></div>

    <div
      id="pagination"
      class="mt-4 flex flex-wrap justify-center gap-2"
    ></div>
  </div>

  <script>
    const ITEMS_PER_PAGE = 50;
    let allData = [];
    let currentRepos = [];
    let currentPage = 1;

    // ä¸»é¢˜åˆ‡æ¢
    const themeToggle = document.getElementById("theme-toggle");
    const savedTheme = localStorage.getItem("theme");
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    if (savedTheme === "dark" || (!savedTheme && prefersDark)) {
      document.documentElement.classList.add("dark");
    }
    themeToggle.textContent = document.documentElement.classList.contains("dark")
      ? "â˜€ï¸"
      : "ğŸŒ™";
    themeToggle.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      const isDark = document.documentElement.classList.contains("dark");
      themeToggle.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });

    function formatDateTime(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, "0");
      const d = String(date.getDate()).padStart(2, "0");
      const hh = String(date.getHours()).padStart(2, "0");
      const mm = String(date.getMinutes()).padStart(2, "0");
      const ss = String(date.getSeconds()).padStart(2, "0");
      return `${y}-${m}-${d} ${hh}:${mm}:${ss}`;
    }

    fetch("repos_data.json")
      .then((resp) => resp.json())
      .then((data) => {
        allData = data;

        let lastUpdateDate = new Date(0);
        allData.forEach((user) => {
          user.repos.forEach((repo) => {
            const pushed = new Date(repo.pushed_at);
            if (pushed > lastUpdateDate) lastUpdateDate = pushed;
          });
        });
        document.getElementById("last-update").textContent =
          "æ•°æ®æœ€åæ›´æ–°æ—¶é—´ï¼š" + formatDateTime(lastUpdateDate);

        const userSelect = document.getElementById("user-select");
        userSelect.innerHTML = data
          .map((u) => `<option value="${u.username}">${u.username}</option>`)
          .join("");
        setCurrentRepos("all");
        renderPage(1);
        updateRepoCount("all");
      });

    document.getElementById("user-select").addEventListener("change", (e) => {
      const user = e.target.value;
      setCurrentRepos(user);
      renderPage(1);
      updateRepoCount(user);
    });

    document.getElementById("show-all").addEventListener("click", () => {
      document.getElementById("user-select").value = "all";
      setCurrentRepos("all");
      renderPage(1);
      updateRepoCount("all");
    });

    function setCurrentRepos(user) {
      if (user === "all") {
        currentRepos = allData
          .map((u) => u.repos.map((r) => ({ ...r, username: u.username })))
          .flat();
      } else {
        currentRepos = allData
          .filter((u) => u.username === user)
          .map((u) => u.repos.map((r) => ({ ...r, username: u.username })))
          .flat();
      }
      currentRepos.sort(
        (a, b) => new Date(b.pushed_at) - new Date(a.pushed_at)
      );
    }

    function updateRepoCount(user) {
      let count = 0;
      if (user === "all") {
        count = allData.reduce((acc, u) => acc + u.repos.length, 0);
      } else {
        const userObj = allData.find((u) => u.username === user);
        count = userObj ? userObj.repos.length : 0;
      }
      document.getElementById("repo-count").textContent = `ä»“åº“æ€»æ•°: ${count}`;
    }

    function renderPage(page) {
      currentPage = page;
      const start = (page - 1) * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pageRepos = currentRepos.slice(start, end);

      const now = new Date();

      const repoList = document.getElementById("repo-list");
      repoList.innerHTML = pageRepos
        .map((repo) => {
          const pushedDate = new Date(repo.pushed_at);
          const diffMs = now - pushedDate;
          const day24Ms = 24 * 60 * 60 * 1000;
          const isRecent = diffMs <= day24Ms;
          const formattedTime = formatDateTime(pushedDate);
          const timeClass = isRecent
            ? "text-gradient font-semibold"
            : "text-gray-400 dark:text-gray-500";

          return `
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-4 hover:shadow-lg transition-all border border-gray-200 dark:border-gray-700 hover:border-blue-400">
            <div class="flex justify-between items-center">
              <a href="${repo.url}" target="_blank" class="text-lg font-bold text-blue-600 hover:underline">${repo.name}</a>
              <span class="bg-gray-200 dark:bg-gray-700 text-xs rounded px-2">${repo.language || "æœªçŸ¥"}</span>
            </div>
            <div class="text-gray-600 dark:text-gray-300 mb-2">${repo.description || "æ— ç®€ä»‹"}</div>
            <div class="flex justify-between items-center text-sm text-gray-500 dark:text-gray-400">
              <div>
                <span>â­${repo.stars}</span>
                <span class="ml-2">ğŸ´${repo.forks}</span>
              </div>
              <div>
                <span>ğŸ§‘â€ğŸ’» ${repo.username}</span>
              </div>
            </div>
            <div class="text-xs mt-1 ${timeClass}">æœ€åæäº¤ï¼š${formattedTime}</div>
          </div>
          `;
        })
        .join("");

      renderPagination();
    }

    function renderPagination() {
      const totalPages = Math.ceil(currentRepos.length / ITEMS_PER_PAGE);
      const container = document.getElementById("pagination");
      container.innerHTML = "";

      if (totalPages <= 1) return;

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = `px-3 py-1 rounded border transition-colors ${
          i === currentPage
            ? "bg-blue-500 border-blue-500 text-white"
            : "bg-gray-200 dark:bg-gray-700 border-gray-300 dark:border-gray-600 hover:bg-blue-500 hover:text-white"
        }`;
        btn.onclick = () => renderPage(i);
        container.appendChild(btn);
      }
    }
  </script>
</body>
</html>
